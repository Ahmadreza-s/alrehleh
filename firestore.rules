rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Newsletter collection - allow public to create subscriptions
    match /newsletter/{newsletterId} {
      // Allow anyone to create a newsletter subscription
      // Validate that the email is a valid string and subscribed is true
      allow create: if request.resource.data.email is string
                    && request.resource.data.email.matches('.*@.*\\..*')
                    && request.resource.data.subscribed == true;
      
      // Deny read, update, delete for clients (only admins via console)
      allow read, update, delete: if false;
    }
    
    // Bookings collection - allow public to create bookings
    match /bookings/{bookingId} {
      // Allow anyone to create a booking
      // Validate required fields
      allow create: if request.resource.data.name is string
                    && request.resource.data.name.size() > 0
                    && request.resource.data.hospitalName is string
                    && request.resource.data.reservationDate is string
                    && request.resource.data.referenceCode is string
                    && request.resource.data.doctorName is string
                    && request.resource.data.speciality is string
                    && request.resource.data.paymentType is string
                    && request.resource.data.phone is string
                    && request.resource.data.phone.size() >= 10
                    && request.resource.data.gender is string;
      
      // Deny read, update, delete for clients (only admins via console)
      allow read, update, delete: if false;
    }
    
    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}